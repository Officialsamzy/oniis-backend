<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart | Onii’s Log Marketplace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #0b0f14;
  color: #e5e5e5;
}
header {
  background: #111827;
  padding: 15px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 {
  color: #22c55e;
}
nav a, .logout-btn {
  color: #e5e5e5;
  text-decoration: none;
  font-weight: bold;
  margin-left: 15px;
  cursor: pointer;
}
nav a:hover, .logout-btn:hover {
  color: #16a34a;
}
.container {
  max-width: 900px;
  margin: 40px auto;
}
.cart-item {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  border-bottom: 1px solid #1f2937;
  padding-bottom: 10px;
}
.cart-item img {
  width: 80px;
  margin-right: 15px;
  border-radius: 5px;
}
.cart-item span {
  margin-left: auto;
  color: #22c55e;
  font-weight: bold;
}
button {
  padding: 8px 12px;
  background: #22c55e;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  margin-left: 10px;
}
button:hover {
  background: #16a34a;
}
.checkout-box {
  margin-top: 30px;
  padding: 20px;
  background: #111827;
  border-radius: 10px;
  display: none;
}
.checkout-box img {
  width: 160px;
  margin-top: 10px;
}
input[type="email"] {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
  border-radius: 5px;
  border: none;
}
</style>
</head>

<body>

<header>
  <h1>Onii’s Log Marketplace</h1>
  <nav>
    <a href="products.html">Products</a>
    <span class="logout-btn" id="logoutBtn">Logout</span>
  </nav>
</header>

<div class="container">
  <div id="cartItems"></div>

  <h3 id="total"></h3>

  <button onclick="checkout()">Checkout</button>

  <div class="checkout-box" id="checkoutBox">
    <h3>Crypto Payment</h3>
    <p>Send the exact USD equivalent in crypto</p>

    <strong>BTC Address:</strong>
    <p>bc1qgxp3pz8kyldrd2mx5hsx64yml2rw7v0ufyjhvc</p>

    <img src="BTC.jpg" alt="BTC QR">

    <input type="email" id="customerEmail" placeholder="Enter your email for logs" required>
    <button onclick="submitOrder()">Submit & Notify Admin</button>

    <p><em>After payment, check your email within 5 minutes for the logs.</em></p>
  </div>
</div>

<script>
const cartItems = document.getElementById("cartItems");
const totalText = document.getElementById("total");
const checkoutBox = document.getElementById("checkoutBox");
const logoutBtn = document.getElementById("logoutBtn");

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart() {
  cartItems.innerHTML = "";
  let total = 0;

  if (cart.length === 0) {
    cartItems.innerHTML = "<p>Your cart is empty.</p>";
    totalText.textContent = "";
    return;
  }

  cart.forEach((item, index) => {
    total += item.price;

    const div = document.createElement("div");
    div.className = "cart-item";
    div.innerHTML = `
      <img src="${item.img}">
      <div>${item.name}</div>
      <span>$${item.price.toFixed(2)}</span>
      <button onclick="removeItem(${index})">Remove</button>
    `;
    cartItems.appendChild(div);
  });

  totalText.textContent = "Total: $" + total.toFixed(2);
}

function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function checkout() {
  if (cart.length === 0) return alert("Cart is empty");
  checkoutBox.style.display = "block";
}

// Logout (just clears cart and reloads for demo)
logoutBtn.addEventListener("click", () => {
  localStorage.removeItem("cart");
  alert("Logged out!");
  location.reload();
});

// Submit & Notify Admin via Telegram
async function submitOrder() {
  const email = document.getElementById("customerEmail").value;
  if (!email) return alert("Enter a valid email");

  const message = `New Order!\nEmail: ${email}\nItems:\n${cart.map(i=>i.name+" ($"+i.price.toFixed(2)+")").join("\n")}\nTotal: $${cart.reduce((a,b)=>a+b.price,0).toFixed(2)}`;

  try {
    const res = await fetch("https://api.oniislog.shop/notify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });

    const data = await res.json();
    if (data.success) {
      alert("Admin notified! Check your email within 5 minutes for logs.");
      cart = [];
      localStorage.removeItem("cart");
      renderCart();
      checkoutBox.style.display = "none";
    } else {
      alert("Failed to notify admin. Try again");
    }
  } catch (err) {
    console.error(err);
    alert("Error sending notification");
  }
}

renderCart();
</script>

</body>
</html>